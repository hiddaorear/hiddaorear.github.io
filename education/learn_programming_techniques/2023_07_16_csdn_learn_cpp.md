# 学习使用C++

## 写C++程序要清楚自己的角色——孟岩

摘要：写程序的时候，不是蒙头写代码，而是在一开始，就要看看代码的使用场景。

- 如果是基础设施，就需要严格考虑接口设计，而且推荐使用主流风格，而不是自己再发明一套，方便大家使用。而且可以大胆使用高级技巧。

- 如果是做应用开发，就使用语言的基础功能，少使用高级技巧，满足应用开放就像。

> 今天跟一些朋友在信件讨论C++的使用。一个还在学习C++的朋友，以为要把重点放在虚函数、多态性、STL上。我认为学习的时候，这样考虑肯定是对的，但是真正开发的实施，不能因为你掌握了OO、generic这些先进武器，就非要用上这些东西，以示区别不可。谨慎合理的使用这些语言机制，是开放良好C++程序的关键，至少在心态上是关键。

> 在写C++的时候，一定要想清楚，你在是在做基础设施，还是在做应用。如果是基础设施，比如类库、框架、底层功能的class wrapper，那么可以允许你大胆使用C++de各种技巧，关键的要求是你得暴露一个clean的interface，让别人觉得好用。这一点并不容易，特别是有的时候，你觉得很好用的接口，人家就觉得很别扭。所以比较省心的做法，就是把接口设计成流行的风格。比如模仿STL风格，模仿COM风格，甚至模仿MFC风格，可以比你自己发明一中新风格要好用。

> 可是做应用开放的时候，手就要把紧一点，别自鸣得意地滥用高级技巧。应用开发，很大程度上，受基础设施的制约，总的来说，使用函数、POD对象、concrete class，从framework中派生出的class，再加上一点点用来节省打字的template，足以满足应用开放的需要。特别是当下，你下面没有很完备的class library，或者framework的时候，千万不要一边写应用，一边又想着怎么让你自己的这些东西“为万世开太平”，那样的话，很容易就会把程序的结构，作得过于复杂。最后往往是应用没写好，也没有可复用性。以前我没有经验的时候，最容易犯的错误就是这个。

> 作基础设施，那叫“设计”，是要为以后考虑的，为了长远的利益，可以牺牲眼前的进度、简单性。可是作应用，那眼前利益是第一位。你先把手头的东西又快又稳的run起来，才谈得上复用的可能。眼前的东西一塌糊涂，说里面的模块设计设计得超级棒，能复用，你自己都不相信。代码要一丝不苟，该写注释写注释，该写assert写assert，该怎么样就怎么样，不能因为想着“反正也就是一锤子买卖”，就马马虎虎。至于能不能复用，那是以后的事情。所谓“Design for today，code for tomorrow”，就是这个意思。
