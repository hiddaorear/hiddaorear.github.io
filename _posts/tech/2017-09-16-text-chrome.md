---
layout: post
title:  文本之Chrome搜索
category: 技术
tags: [text]
keywords:  text Chrome
description:
---

##  文本之Chrome搜索

#### Saturday, 16  2017 September

![ChengBi](/../../assets/img/tech/2017/ChengBi_1.jpg)

读数学，或者物理书的时候，或者读算法书的时候，常常纳闷，有些结论显而易见，为什么自己想不到。

类似的问题在读源码时也会有，如此巧妙的实现，自己为什么想不到呢。看源码是程序员成长的好办法，但源码不能显示编码的过程，也是一种遗憾。我有时候很喜欢很同事敲代码，可以学到很多良好的习惯。这其中，最有益处的，是调试的过程。

### 大处着眼

#### DOM的变化

DOM有变化，则可以使用Chrome的DOM的Break on，有三种类型：subtree modifincation（子节点）, attribute modifincation（属性）, node removal（节点被删除）。

页面上有弹出层，在其中选择一些标签，点击确定之后，被选中的标签显示在页面上。我们可以在页面上添加subtree modifincation断点，就可以快速定位到添加标签DOM的代码。要比找到标签的class，然后去全局搜索来的快。后者常常不易找到对应的代码，因为绑定的class需要猜测，而有些人喜欢用事件委托，事件根本没有绑定在单个的元素上，就更不容易查找了。

#### DOM的事件

找到对应的DOM事件的监听代码，相比之下，则没有这么容易。有两种办法，其一，使用插件，Chrome 使用jQuery Audit插件，或者Visual Event插件。其二，在Performence的Event Log中查看执行记录。

而Chrome提供的Event Listeners，鸡肋。除非的是只用原生的事件监听。此处会列出所有的涉及到这个DOM元素的事件，导致他价值不大，你无法找到对应的代码。还有一个Event Listener Breakpoints，可以对所有的事件断点，暂时也未发现有好的技巧定位到对应的代码。

这个功能并不好用，因为如果引入框架或函数库，就麻烦了。各种框架对事件处理思路，基本上是要自己做一套事件系统，而这个一般思路，就是把事件代理了。所以这个时候，你会看到，一个DOM上绑定了很多个事件。可以留意一下对应的文件名，找到来自自定义的文件，查看一下，如果顺利，也可以找到对应的代码。这也提示大家，平时写事件的时候，不要滥用事件代理，只在必要的时候使用，一个按钮就没有必要，但一列按钮就需要事件代理。很多时候滥用的缘由与DOM加载有关，如果直接绑定，DOM未加载则不生效。但jQuery的事件委托刚好可以绕过这个问题。此时，应该判断DOM是否加载，再绑定即可。

当然查看DOM事件有一个好处，就是旧代码可能也绑定了这个DOM的事件，并且阻止事件冒泡等，如果你新增一个绑定，则有时候会不生效，这个时候就百思不得其解。表象就是，有时候事件生效了，有时候没有生效。让人烦躁不已。所以写代码的时候要注意，事件绑定最好有惯用的class，或者id来绑定。调试代码起来，一目了然。

虽然定位的问题的办法众多，对于陌生的代码，由表及里，不外是通过DOM找到对应的代码。而通过DOM定位，则也只有两种情况，其一，DOM自身的改变；其二，DOM上绑定事件来改变其他DOM。概莫能外。

### 小处着手

#### `console.log`

打印变量是所有调试所有代码的神器，甚至有些情况下也是唯一的办法。当然还有alert，在一些情况下也很有用。比如webpack等工具会删除console的代码，如果懒得修改配置，则直接alert，或者手机上alert一下，也是极好的。

`console.log`其实有众多兄弟姐妹，`console.info console.warn console.error`，所不同者，打印出来的展示形式不同而已。很多同学用这些，也是好色而已，有时候console中打印很多东西，为了让自己想看的结果醒目，则需要颜色，或者在前面加上一长串字符，如`console.log('^^^^^^^', var)`之类。

其实`console.log`还有支持CSS，这下子正好可以解决好色之徒的问题。`console.log('%cYvan', 'color:red; background: blue;')`。

当然还有`console.table`之类，也很有用处。consle类似shell，有shell的快捷键可用，`Contrl+l`可以清空console中的输出。
如果遇到使用iframe的情况，console支持切换环境，类似于with的用处。

#### JavaScript断点

断点有两种情况，其一，在sources中的断点；其二，代码中debugger。前者在临时分析问题时常用；后者，在处理疑难杂症常用。无区别，只是后者调试完要删除，不删，提交上去，队友调试起不便。

断点之后，较为有用的信息是Call Stack，列出了函数调用的来龙去脉。鼠标移到代码中的变量上，可以显示其值。现在开发，极少存粹原生代码，所以断点之后，单步调试，冷不丁就会跑到库或者框架的代码中，而一时又不容易跳出来，又不能直接跳过，烦躁异常。这时，我们找到对应的代码，把其标记为Black Script，则不会进入这个脚本。其他的DOM断点，事件断点，亦然。

这里有一个小技巧，就是断点之后，里面变量可以console使用。`Control+Shift+o`快捷键，可以定位到对应的函数。类似于console中流出的debugger辅助函数。

至于性能问题，这里暂不讨论，可以另写一篇。


### 文本搜索

如果以上办法都行不通，此时定位问题，只有一招，那就是搜索。CSS问题，搜索一般去搜索引擎去找。JavaScript问题，则需要在Chrome中搜索。

在搜索之前，我们稍微看到一下上面class与id，如果有id优先搜索id，其次搜索class。所以，此时，我们整理一下思路，预计一下后续的搜索关键词，逐个逐个来。不可以乱序，如果没有搜索到对应的代码，乱序之后需要重来，太浪费时间。

而搜索范围，从小到大。优先在此HTML文本中搜索，其次去全局搜索。这里没有什么技巧，耐心耐烦而已。已经是下下策了，别无他法。

现在JavaScript文件都是编译之后的，搜索定位问题，造成麻烦，此时找编译之后代码，还得猜测一下源码。

定位问题从小到大，替换文件，要从大到小。前段时间替换大量的文件，需要先粗略关键字搜索，看一下对应的目录，然后提取自己想要目录规则，再次搜索。

支持使用IDE的`Contrl+p`模糊匹配文件的功能，在知道对应的文件名，查找文件时，特别方便。


### 避免搜索

搜索第一件事，是如何避免去搜索。搜索是不得已而为之的技巧，首先我要分析，问题是什么，即使到了搜索这一步，可以有的放矢的去搜索，宁做狙击手，不用散弹枪。

自己写的代码，应当条理清晰，执行条件分明，语句执行来去有由。可以在大脑里思考一下，问题出在哪里。这个效率最高，但依赖经验，以及良好的思维习惯。

别人写的代码，需要去找到对应的开发。然而，我发现最好不要轻易找对应的同事，因为大家各自有事情在忙，你去找人家，造成对方思维中断，次数多了，对方会不厌其烦。如果问题低级，可能被对方打上标签，怎么这么简单的事情来问我。而同事找问题，因为代码是他写的，熟悉，找问题有针对性，可能一下子就找到了，此时正中心中烦，如此简单。事实上，在没有具体的信息的情况下，问题的边界，不会如此清晰，复杂度是不可同日而语。在种情况下，只能自己多花时间，定位问题，直到定位到自己十拿九稳的程度，方可以去找对方讨论。用QQ等通信工具，胜于人过去。人过去，对方需要立即中断答复。通信工具，可以等到对方空下来看到了，再处理。总而言之，自己多花时间，是一种处理问题的方式，也是一种礼貌。

前端开发一般不用关注后台的处理，只需要关注接口所给数据即可。但有模糊之处，比如初始化的值，如何设置？报错提示，是前端自己定义显示，还是使用后台返回的提示语？正是如此，当返回的提示信息不对的时候，第一不是去查后台返回的信息，而是确定这里是前端自己定义的提示，还是直接显示后台的提示语。

出问题了，第一步是打开控制台，看报错信息。这是大家习惯，看到报错信息，点击，看到报错处的代码，断点，单步调试，看代码执行情况。能看到报错的情况，基本这样就找到问题所在，一般都是与DOM相关，例如没有这个DOM的情况没有加上判断，或者没有判断DOM是否加载完成，就直接使用DOM。一般会报错，没有属性，或者没有length，之类。

如何没有看到报错信息，这类问题，处理反而要多花功夫。所以写代码的时候，不要随意try，catch错误。让必要的报错暴露出来。如果没有报错，只能从对应的现象开始分析，与DOM相关，则可以使用Chrome的一些好用的功能。



## 参考资料：
Chrome官方文档

Yvan say：前端开发中，定位问题，调试，要消耗很多时间。而非编程以纯函数式，还是面向对象编程。而查找是定位问题中的第一步，也影响效率的第一步。一个问题不能定位到对应的代码，令人丧气，加班随之而来，精力徒然消耗，效率焉不能低。熟练在Chrome查找代码，很大程度上影响一个了一个前端程序员的效率。而代码是文本，搜索，定位问题，不外乎在是多个文件，寻找一个模式。以这个思路，我总结一下，开发中常用的一些办法。

为什么写成一个系列呢？

我好友常告诉我，很多时候遇到问题，不知道怎么使用搜索引擎。现在体会到其中烦恼了。最近做项目，涉及很多陌生代码，需要在其中查找定位问题，很麻烦，也需要总结一下。当然还有，我决心要把Mac作为日用的开发机了，公司电脑屏幕不太好，每天加班到地铁最后一趟，眼睛干涩，在电梯的光滑的金属门上，瞥见一双陌生的红眼，心里愕然。想不常加班，得换一种方式开发。

最后，文本作为我们最相关的一种的数据结构，却也是我们陌生的数据结构。文字，代码，都是文本构成。web开发中常用的正则表达式，也是文本处理的利器，常用，而真正知其所以然的人，不多。
