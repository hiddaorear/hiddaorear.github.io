---
layout: post
title:  新技术新环境下的项目
category: 技术
tags: [工程管理]
keywords:  工程管理
description: 
---

###  新技术新环境下的项目

#### 2017年2月20日至2017年4月11日销售金额项目

#### Monday, 27  2017 Mar.

![陈璧](/../../assets/img/tech/2016/ChenBi_18.jpeg)



### 工具


#### FTP

由于需要把代码发布到远程环境，通过FTP完成，在缺少插件的情况只要使用其他编辑器，这次主要是Atom，安装FTP插件。由于网络环境原因，用Atom的办法无法安装成功，费时半天。后面去找办法，直接去github上clone源码，用npm安装。同时由于只有两种方法触发FTP上传，保存的时候，或者手动上传，不能自动同步，很不方便。有一次周末加班，很想把这个问题解决，用了一个很强大的FTP软件FileZilla来处理，配置到最后发现需要远程和本地文件目录名一样，只能放弃了，回来用编辑器插件来上传。CSS用了SASS，需要中间编译一下，每次修改了都要手动去上传一次，非常麻烦。有时候写代码比较急躁的时候，忘了上次，刷新半天才回头发现是没有手动上传代码，非常影响心情。准备试用一下sftpdrive，把远程的仓库映射到本地，在本地直接修改远程代码。不过如此，估计得搭建一遍远程的前端开发环境。

#### Vim

习惯使用Vim，并只设置简单的基本的配置，没有装插件。所以没有比较好的代码补全，写代码时无提示，无代码格式检查，以及格式化工具。
用Vim时间久了，只想再尝试一下Emacs，其他编辑器都不太像尝试了。在这期间，不得已，试用了一下Visual Studio Code、Atom、WebStorm和老牌的Sublime。由于配置好Atom的FTP插件的原因，没用他最多。他们辅助使用，Submit比较熟悉些，用的频率最高。同时，看同事用VS Code，发现也很好，以前去参加技术分享有人用这个编辑器，当时发现确实做的不错。有闲暇可以尝试着去学一下。毕竟我目前没有深度使用一款IDE。以前用过Eclipse和My Eclipse，打开太慢了，还没有用熟悉就弃用了。我想是时候配置一下vim了，安装一些必要的插件。

#### Git

还有就是git工具，一直以来都是用命令行操作，看到同事用带UI界面的，也挺方便的，后面看情况，也可以去尝试一下。虽然我觉得命令行更好。git是一个很好的工具，到现在算是一个很浅的使用罢了，虽然我也零零碎碎知道他背后的原理。实质是一个具有数据库数据结构的文件系统。以前用Linux时，被里面的文件系统给弄得眼花缭乱，算了了解到一点东西。同时，深度的使用还谈不上，很想抽时间把这个工具好好整一下。

#### Webpack

中间完成开发时，用webpack打包，此时发现一个问题，由于是用上一个项目的架构，并复用他的打包配置，导致现在的项目的输入文件会覆盖掉原有的文件，这样需要重新修改一下打包目录。同时在打包时发现报错，简单查看了一下代码，基本确定了是路径不对。只好去改源码，而项目进行到这个阶段，我已经非常累了。前面连着加班，周末过来通宵过一次，接连一个多月每个周末放假最少要空出一天来公司加班，晚上连着都是1点2点睡觉，早晨要7点半之前起来，每晚睡眠大概5个小时，上午上班强打起精神，中午午休会睡过头，下午加把劲干活，晚饭后累，加上吃饭之后血糖升高，昏昏欲睡。

改这个配置文件的时候已经是强弩之末了。折腾了半天，还是有些问题，虽然是小问题，但此时实在没精力了，只好找老大来帮忙修改一下。总算是修改好了，后头看了一眼这里乱七八糟的操作文件的函数，有想重写的冲动。

这些开发环境配置问题，在项目初期就该考虑到，到后面时间紧，还要处理这档子事，累。为什么没有提前暴露出这个问题呢？因为当时我想到一个联调的办法，可以避免每次更新都要跑去服务器更新代码，让后台的同学直接连到我本地的起的服务。当时遇到一个跨域的问题，花了半天时间。没曾想，后面还是要在这上面耗费时间。

在修改配置文件时候也暴露出对Node的不熟悉，一个小问题花上半天时间，后续补全这个方面的技能。


### 技术

jQuery的部分代码有1700多行，React的部分十几个组件，核心组件4个。还有一部分是React写的旧代码，但我现在用jQuery实现了，就移植过去。所以项目里有三种情况，一个React的，一个是jQuery的，一个React和jQuery混合的。

#### React和jQuery混合开发

修改旧的React代码之后，就是一致弹出层的组件过来，里面涉及日历等组件，同时两边要严格保持一致。在这个情况下，选择重新用React开发一边已实现的，太浪费时间了。想了半天怎么移植过来。当时对自己写的JavaScript的移植还是容易的，因为把原来的代码封装到一个模块即可。而CSS与其他插件，就不太好处理了。CSS在进来，编译不通过，估计是格式之类的，一看里面还有兼容IE6之类的代码，hack也有，代码又乱，不可能去修改，工作量太大。而JavaScript插件也得花时间去封装，而现在时间很紧。思来想去，只好暴力一点，在入口文件里面直接引入CSS和JavaSciprt文件。在我封装的里面直接调用即可。


#### React

分析需求的时候，发现有组件可以复用，于是依据此做相关的架构设计来。把组件切分得很开，开始的时候看起来很优雅。心想这个才是组件化吗，想怎么复用就怎么复用，一个一个像积木一样拼装起来，写得很开心。然而，这个却成了我想修改的部分。以前看到Linux的微内核和宏内核的争论，置身事外，虽然决定对方都有道理，但无关痛痒。这次我就扎扎实实体会了一次微内核的不便之处，通讯成本实在是高。

而这里使用的是Redux，这个家伙又加剧了这个成本。每一次更新要发起action，然后去写对应的Reducer，然后去Redux-React去写map函数，然后在Class里引入，然后从porps上取到值，然后再使用。如果是异步的情况，还得在action发起之后再发一个action。如果用jQuery后者AngularJS也就一行代码的事。写到后来，不胜其烦，加之人又累，烦不胜烦。虽然前期这套东西跟我一个很优雅的印象，然而此时觉无暇消受，只想快速完成业务。

所以以后设计组件的时候，一定不能过度的隔离，可以适当的在一个组件聚合也该聚合一起，省去很多通信的代码。注意，通信成本其实很高。

由于组件化使得架构化整为零了，而实质还是一个整体。所以前期架构的时候，一定要把通讯就考虑进来。如果边写边添加action和reducer，会导致后面的action与reducer混乱，自己也不知道数据是如何流向的了。我们最好能把组件和通信画一张图出来，这样有了设计之后，再开发。

项目中我初次使用AntD，不熟悉，要用到的地方，都是匆匆忙忙去官网看一下例子。其中遇到表单校验的问题，对应的校验信息如何显示。看到他原生的组件用起来实在麻烦，但此时也只好将就着使用。由于看例子也了无耐心，匆匆看了就匆匆动手写，无暇考虑深一点层次的使用。导致有一个点的使用没有深入，后续不没有意识到还可以更好的使用，后面想了迂回曲折的办法，实在麻烦而费事。可见做事实在是不能着急，心态得平和，着急能做好事吗？不能的。

同时对于Redux的设计，这个设计很优雅，但在忙碌的开发中，在赶工期的情况下，开发效率确实让人着急。他的优雅，决定他的啰嗦。在组件间通信时，如果只有一层，能用回调就用回调，不想去为了一个简单通信写一堆东西。有时候烦躁起来，写了三层的回调，后面想起这也烦躁了，后头又去把这么不优雅的代码删除了，改用Redux实现。有时候想，其实我们代码如何在如何匆忙，都需要严谨，不然后面会花更多的时间，就更匆忙了。如果一个有Redux的优雅，又能便于开发，代码更简洁，我一定毫不犹豫去用这个方案。

不过，有一点就是，这个是头一次在正式而重要的项目用React，技术上采用保守的方案，Redux有很多便于开发的中间件都没有使用。现在想来，如果开始的时候使用了这些中间件，应该能省去很多时间。但担心用这些需要额外的时间学习时间成本，当时的心态就是快速开发，要在后台开发完成之前完成。但磨刀不误砍柴工的道理，我这次该是懂了。我想做事为啥要这么着急呢，有什么好急的呢？着急，刚而无用，扯着嗓子讲话，谁都不爱听。

同时，在开发的时候发现，表单校验实现，其实非常麻烦。远没有自己印象中的简单。以前用AngularJS，实现这些东西很快，因为有封装好组件，做得非常好，拿来用，很是便捷。但这里却是没有这么方便的组件，有现成了，但需要在上面修修改改加功能。还有一点就是，由于是后台系统，做的时候并没有注意UI，因为很少有后台系统还需要注意UI的。但这次不同，对UI要求非常严格，由于有一个开发好的功能在先，事事都要与之保持一致，后续需要修改的地方太多，也是不胜其烦。毕竟没有按照设计稿来，后面强压心里的烦躁，耐着性子改。没有办法，技术评估没有提，设计稿又在那里，只能修改。

#### jQuery

表单校验数字的校验与禁用输入，遇到很多细节问题。重置表单值之后光标位置需要手动修改，不然就放到最后了。日历组件都有一个滚动时无法跟随滚动条定位的问题，开始的找的几个开源组件也有这个毛病，后面用一个旧日历组件也有这个问题。去看看原来是怎么解决的，原来他们把页面嵌在一个iframe里面，就滚动条就是独立页面的滚动条，避免了这个问题。但我这边是一个弹出层，不能用这招，考虑到性能，也最好不要用这个招。我在这个上面浪费太多时间了，通宵的那天晚上，找好的日历组件就找了3个多小时，从1点找到3点多，加上前半夜的时间，此时已经悔不跌。赶紧止损，切换去开发业务。当时的心态也是，我都投入这么精力，一定要把这个解决，事情是要一定条件才能做成的，不能以人的意志转移。这么做事，不分轻重缓急，哪能把事情做好。

jQuery的代码被一个个封装为独立的函数，相互调用，自以为很方便。没有用面向对象的办法。总觉得JavaScript面向对象不好使，用函数式编程风格。加上语言有变量提升的功能，可以随意定义函数，在作用域里面随意调用。这次的代码量有1700多行，在函数里面调用函数，后面找代码的时候只能通过搜索，且函数互相没有固定的方式，把一个函数放在另一个函数里面调用了事。后面细想，这个组合方式太粗糙了。数据流可以用Promise，jQuery的Promise实现虽说不真宗，但够用，这次使用起来很方便，也很清晰。涉及数据流都可以使用。但函数组合的办法则没有好招了，也没有使用Curry等典型的函数式编程方式。以后可以写几个这方面的工具函数，实现管道，Curry化，反Curry化等。

同时，在jQuery里使用事件，一定要严谨。不可以随意绑定，随意reture掉事件，以及在事件里面trigger事件。这次遇到一个事件rigger导致循环调用，很诡异的表现。同时，也遇到由于有代码return事件导致事件没有监听到的情况。幸好代码量还不是很大，要不然真是一团糟。

得空我想看一下jQuery的源码，特别是他事件实现机制。目前看到的版本有是jQuery自己实现的事件系统。


### 需求

### 心态

### 收获

Hid say：吃一堑。
