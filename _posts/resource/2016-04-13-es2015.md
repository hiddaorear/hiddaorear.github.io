---
layout: post
title:  ES2015
category: 资源
tags: [ES2015]
keywords: ES2015
description:
---

### ES2015

#### ES2015

#### Tuesday, 13 April 2016

![ChenBi](/../../assets/img/resource/2016/ChenBi_4.jpg)

### Promise

Q:下面四种写法的区别(假定`doSomething()`和`doSomethingElse()`都是返回promise)：

```javascript
doSomething().then(function() {
  return doSomethingElse();
})
.then(finalHandler)

doSomething().then(function() {
  doSometheingElse();
})
.then(finalHandler)

doSomething().then(doSomethingElse()).then(finalHandler)


doSomething().then(doSomethingElse).then(finalHandler)

```

### Promise比回调函数多了什么?

给予我们在异步中丢失的语言基石：`return`,`throw`以及堆栈。

他是一种代码结构和流程，一个promise被创建，立即被执行，不可以取消，也不可以延迟，需要延迟要用匿名函数包裹起来，并返回一个新promise。

同时`then`只能传递函数，这就是为什么要匿名函数包裹起来的原因。

### 错误用法

1  需要有两个以上的一步操作时，出现Promise嵌套金字塔。解决：按照顺序放在then执行。

2  在promise中使用forEach。需要用`Promise.all()`包起来。

3  忘记了`catch()`。

4  无需使用`deferred`。用构造函数包括起来即可。

```javascript
new Promise(function(res, rej) {
  fs.readFile('file.txt', function(err, file) { 
    if (err) { 
    return rej(err)
  } 
  resolve(file)
});
}).then()
```

5  没有返回值。

```javascript
somePromise().then(function () {
  someOtherPromise();
}).then(function () {
  // Gee, I hope someOtherPromise() has resolved!
  // Spoiler alert: it hasn't.
});
```
在then中，我们只能做两件事：`return`另一个promise或者同步值或者`undefined`,`throw`一个异常。


### Promise好用的写法

1 处理同步或的异步异常：

```javascript
function somePromiseAPI() {
  return Promise.resolve().then(function() {
    doSomethingThatMayThrow();
    return 'foo'
  }).then(/*....*/).catch()
}
```




## 参考资料：

[Immutable 详解及 React 中实践](https://github.com/camsong/blog/issues/3)

[MDN Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise)

[翻译 We have a problem with promises](http://div.io/topic/1095)

[Promises: 所有的错误使用方式](http://www.zcfy.cc/article/promises-all-the-wrong-ways-getiblog-493.html)

[Anti-promise Promise反模式](https://segmentfault.com/a/1190000007395254)

[Promise 反模式](http://taobaofed.org/blog/2016/05/03/promise-anti-patterns/)






hid say：Hello World!
