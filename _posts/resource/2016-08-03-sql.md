---
layout: post
title:  SQL
category: 资源
tags: [SQL]
keywords: SQL
description:
---

### SQL

#### SQL

#### Wednesday, 03 Aug 2016

![cassini](/../../assets/img/resource/2016/cassini_5.jpg)

> 我想很多有经验的数据库使用者都理解，关系式模型的每一个“关系”或者“行（row）”，其实表示的不过是一个普通语言里的“结构”（比如C的struct）。一个表（table），其实不过是一个装满结构的数组。每一个join，其实就是沿着行里的“指针”进行“寻址”，找到他说指向的东西。当然，这些操作都是基于“集合”的，但这并妨碍你使用普通的语言（比如C后者Java）来完成这种操作，他们都可以通过很简单的“库代码”来完成。
-王垠

> 由于经典的关系“行”只能有固定的宽度，所以导致了你没法在结构里面放任何“变长”的东西。比如，如果你有一个变长的数组需要放进结果，你就需要把他单独拿出来，旋转90度，做成另外一个表，然后再原来的表里用一些“key”指向他们。这通常被叫做normalization。
-王垠

## 典型用法

### 数据库设计

以下订单表的问题：

|id | name | number | price | total_price|
|:-:|:----:|:------:|:-----:|:----------:|
|1  | ip5  |  5     | 5000  | 25000      |
|2  | ip6  |  4     | 6000  | 24000      |

> 答：
设计要依实务逻辑而定。我们考虑实现中订单的一般特性：

> - 订单总是大量客户订少量的商品，多个订单中商品名称会频繁重复；

> - 一张订单可能包含多个商品；

> - 总价格是间接数据；

> 那么这张表，从数据库范式的角度来看，有以下问题需要纠正：

> - 应该有一个产品表，把name提取出去，订单条目表格用name_id链接；

> - 这个表格本身只是“订单条目”，无法表示一张含有多种商品的订单，表格本身就是错的。必须有一个“订单”表格，然后通过多对多关系与“订单条目”表格对应；

> - total_price是计算的间接数据，不应当存在；

> 所有性质的缓存，都是一个付出冗余和破坏数据一致性的代价，来换取性能的选择。所以这个选择中最重要的原则就是:只允许实务数据推翻缓存，反响绝不允许。

> 并且，实际应用中为了性能的关系，保留冗余的数据作为缓存更是必要的手段。但缓存就是缓存，绝对不允许和实际数据列之间，存在混淆的可能。所以，这个表格里面，如果name和total_price为了减少数据库查询压力而缓存，那么至少应该改名叫cache_name和cache_total_price。更优的办法是把所有待缓存的数据序列化之后，用`BINARY/BLOB`类型存成`cache_serialized`一列。直接人类不可读，省去麻烦。



### 分页实现

````sql
SELECT * FROM table
  where create_time >= '2016-01-01' and create_time < '2016-08-08'
  and pk not in (?) // 这个ID是上次取到的create_time最大的值的所有记录的pk值，优化性能
  and x = 3
  and y > 0
  order by create_time
  limit 1
  offset 0;

````

### `B-tree`

局部性原理：但一个数据被用到时，其附近的数据也通常马上被使用。程序运行期间所需要的数据通常比较集中。

磁盘预读：由于磁盘顺序读取的效率很高（不需要寻道时间，系需要很少的旋转时间），因此对于具体局部的程序来说，预读可以提高`I/O`效率。预读的长度一般为页（page）的整数倍。




## 参考资料：

[SQL，NoSQL 以及数据库的实质](http://www.jianshu.com/p/092b1555ca3d#)

[关系模型的实质](http://www.yinwang.org/blog-cn/2014/04/24/relational)

[求教SQL面试题目：单张表查询某字段排在第二或第n-1问题？](https://www.zhihu.com/question/29512075)

[讨论一下mysql数据库中千万级数据如何分页？](https://yq.aliyun.com/ask/5030)

### 原理

[数据库的最简单实现](http://www.ruanyifeng.com/blog/2014/07/database_implementation.html)

[MySQL索引背后的数据结构及算法原理](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)

[由 B-/B+树看 MySQL索引结构](https://segmentfault.com/a/1190000004690721)

### 典型实现

[微博feed系统的推(push)模式和拉(pull)模式和时间分区拉模式架构探讨](http://www.cnblogs.com/sunli/archive/2010/08/24/twitter_feeds_push_pull.html)

[BAT面试题，求帮忙分析下这个数据库表有什么问题](https://segmentfault.com/q/1010000003936216)



### UML工具

Dia

Astah Community

Umbrello 


[数据库杂谈之：如何优雅的进行表结构设计](https://zhuanlan.zhihu.com/p/20785905)

hid say：日日新。
